require 'rails_helper'

RSpec.describe Fingerprinter::Acoustid, type: :service do

  describe 'with 13 Dust and Memories.mp3' do
    let(:path_to_file) { "#{Rails.root}/spec/fixtures/files/itunes/Music/Unheard\ Music\ Concepts/The\ Lasso\ of\ Time/13\ Dust\ and\ Memories.mp3" }
    let(:output) { File.read "#{Rails.root}/spec/fixtures/chromaprint_fingerprints/13_Dust_and_Memories.fp" }

    describe "#initialize" do
      subject { described_class.new(path_to_file) }

      its(:duration) { should eq(121) }
      its(:cleansed_fingerprint) { should eq('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')}
      its(:output) { should eq(output) }
      its(:path_to_file) { should eq(path_to_file)}
      its(:fp_url) { should eq("https://api.acoustid.org/v2/lookup?client=o4Wf01oR4K&duration=#{subject.duration}&fingerprint=#{subject.fingerprint}&meta=recordings+releasegroups+compress")}
    end
  end
end